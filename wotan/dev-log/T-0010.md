# T-0010: Build and push URM Docker image to ICE registry

**Status**: DONE
**Phase**: COMPLETE
**After**: â€”
**Before**: T-0011

## Context

To avoid version compatibility issues and slow pod startup, build a custom Docker image with all dependencies pre-installed (PyTorch 2.4, flash-attn, adam-atan2, etc.).

## Acceptance Criteria

- [x] Dockerfile builds successfully
- [x] Image pushed to registry.ice.ri.se/aic-misc/urm-training:latest
- [x] Image contains PyTorch 2.4+ with CUDA
- [x] Image contains flash-attn
- [x] Image contains adam-atan2

## Verification Plan

### Tests to Create
| Test | Proves | Status |
|------|--------|--------|
| `docker build` | Image builds | - |
| `docker push` | Image in registry | - |

### Regression Check
```
docker run --rm registry.ice.ri.se/aic/urm-training:latest python -c "import torch; from flash_attn import flash_attn_func; from adam_atan2 import AdamATan2; print('OK')"
```

### Manual Verification
- [ ] Confirm image is accessible from ICE cluster

## Approach

1. Build image using ice/Dockerfile on a machine with Docker
2. Push to registry.ice.ri.se/aic/urm-training:latest
3. Verify imports work

## Implementation Notes

### PLANNING
Decided to use Kaniko to build the image directly on ICE cluster (no local Docker needed).

### IMPLEMENTING
1. Created Dockerfile in ice/ with PyTorch 2.4.0-cuda12.4 base
2. Created Kaniko build manifest with registry credentials
3. Launched build pod on ICE cluster
4. Build completed successfully with all dependencies

### TESTING_GREEN
Build verification output:
- PyTorch: 2.4.0 (CUDA support verified at runtime)
- flash-attn: OK
- adam-atan2: OK

## Evidence

Build pod logs confirmed successful push:
```
INFO[1203] Pushed registry.ice.ri.se/aic-misc/urm-training@sha256:bb9c336b7ca70d89982c49bdc8d30a13c2c3027c75a05f60a7b873d2b5178fd1
```

## Outcome

Image available at: `registry.ice.ri.se/aic-misc/urm-training:latest`

Contains:
- PyTorch 2.4.0 with CUDA 12.4
- flash-attn 2.8.3 (pre-compiled)
- adam-atan2 0.0.3 (pre-compiled)
- wandb, einops, hydra-core, numba, triton, etc.
