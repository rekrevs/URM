# T-0014: Migrate wandb data to online

**Status**: DONE
**Phase**: VERIFIED
**After**: —
**Before**: —

## Context

Training runs on ICE are logging to wandb in offline mode. The run data is saved locally at `/workspace/wandb/offline-run-*` on the pod. Need to sync this data to wandb.ai for online viewing and configure future runs for online logging.

## Acceptance Criteria

- [x] Existing offline wandb run data synced to wandb.ai
- [x] train.sh configured for online wandb logging
- [x] WANDB_API_KEY available in pod environment

## Verification Plan

### Tests to Create
| Test | Proves | Status |
|------|--------|--------|
| Manual: Check wandb.ai dashboard | Data is visible online | - |

### Regression Check
```
wandb status
```

### Manual Verification
- [x] Verify run appears on wandb.ai
- [ ] Verify new training run logs online (next run will use online mode)

## Approach

1. Sync existing offline run using `wandb sync` with API key
2. Update train.sh to set WANDB_MODE=online and pass WANDB_API_KEY from environment
3. New pods will require WANDB_API_KEY set in the launching environment

## Implementation Notes

### PLANNING
- Offline run at `/workspace/wandb/offline-run-20251221_135226-qx7cv6mw` (2.9M)
- train.sh had WANDB_MODE=offline on line 91
- Need to inject WANDB_API_KEY from environment

### IMPLEMENTING
1. Updated ice/train.sh:
   - Changed WANDB_MODE from "offline" to "online"
   - Added WANDB_API_KEY env var that reads from shell environment

2. Synced offline run:
   ```bash
   kubectl exec -n aic urm-e2e-test -- bash -c 'export WANDB_API_KEY=... && wandb sync wandb/offline-run-20251221_135226-qx7cv6mw'
   ```

### TESTING_GREEN
- Sync completed successfully
- Run visible at: https://wandb.ai/sverker-janson-rise/arcagi/runs/qx7cv6mw

## Evidence

```
$ kubectl exec -n aic urm-e2e-test -- bash -c 'export WANDB_API_KEY=... && wandb sync wandb/offline-run-20251221_135226-qx7cv6mw'
Find logs at: /workspace/wandb/debug-cli.root.log
Syncing: https://wandb.ai/sverker-janson-rise/arcagi/runs/qx7cv6mw ... done.
```

## Outcome

Successfully migrated wandb data to online:
- Existing offline run synced to wandb.ai
- train.sh updated for online logging (WANDB_MODE=online)
- Future pods will use WANDB_API_KEY from environment
